<h1 class="text-center display-1">Добавить точку</h1>
<div class="container-lg">
  <div id="map"></div>
  <%= form_for @point do |f| %>
    <h3 class="display-3">Введите показания</h3>
    <div class="form-group">
      <%= f.text_field :decibel, class: 'form-control', placeholder: 'Среднее значение (дБ)' %>
    </div>
  <% end %>
</div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBm2rSuphVK9QJyiyPkd4LN1SQj7yeMnw0&region=RU&&libraries=places"></script>
<style>
    #map {
        height: 800px;
        width: 100%;
    }
</style>
<script>

    var pos;
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 19,
    });

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }
    function showPosition(position) {
        var lat = position.coords.latitude;
        var lng = position.coords.longitude;
        pos = new google.maps.LatLng(lat, lng)
        map.setCenter(pos);
        setMarker();
    }

    function setMarker() {
        marker = new google.maps.Marker(
            {
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                position: pos
            });


        google.maps.event.addListener(marker, 'dragend', function () {
            geocodePosition(marker.getPosition());
        });
    }
    function geocodePosition(pos)
    {
        geocoder = new google.maps.Geocoder();
        geocoder.geocode
        ({
                latLng: pos
            },
            function(results, status)
            {
                if (status == google.maps.GeocoderStatus.OK)
                {
                    $("#mapSearchInput").val(results[0].formatted_address);
                    $("#mapErrorMsg").hide(100);
                }
                else
                {
                    $("#mapErrorMsg").html('Cannot determine address at this location.'+status).show(100);
                }
            }
        );
    }

    getLocation();
</script>